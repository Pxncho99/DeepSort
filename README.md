Based on this GitHub: https://github.com/yasarniyazoglu/YoloV5-and-DeepSort-Custom-Dataset/tree/main
Some modifications where done in order to run correctly the scripts.



# Yolov5 + Deep Sort in Custom Datasets


## Introduction

This repository contains a two-stage-tracker. The detections generated by [YOLOv5](https://github.com/ultralytics/yolov5), are passed to a [Deep Sort algorithm](https://github.com/ZQPei/deep_sort_pytorch) which tracks the objects. It can track any object that your Yolov5 model was trained to detect.



## Before you run the tracker

1. Clone this repository.

2. Make sure that you fulfill all the requirements: Python 3.8 or later with all [requirements.txt](https://github.com/mikel-brostrom/Yolov5_DeepSort_Pytorch/blob/master/requirements.txt) dependencies installed, including torch>=1.7. To install, run:

`pip install -r requirements.txt`


## Running the code

In order to run everything correctly, make sure to have a pretrained .pt file using yolov5. In this particular case, the track.py is runned using the bestv11.pt file and using as a source the fvideo.avi. The --save-vid and --save-txt options are set so a final video and a txt file with labels will be exported to `inference/output`. 

Moreover, you need a `ckpt.t7` file inside `deep_sort_pytorch/deep_sort/deep/checkpoint/`. The original file, trained with pedestrians, could be find in the next link: `https://drive.google.com/drive/folders/1xhG0kRH1EX5B9_Iz8gQJb7UNnn_riXi6`. 
If you want to train the deepsort model with your own dataset, go tho the next section for an explanation on how to get the ckpt.t7 file.

Finally, if everything is correctly installed, execute the next code:

`python track.py --yolo_weights bestv11.pt --source fvideo.avi --save-vid --save-txt`

For more info run:

`python track.py -h`

## Training with your own dataset

If you want to train deepsort with your own dataset, you should run `\deep_sort_pytorch\deep_sort\deep\train.py"`. But before, make sure to have inside the folder `\deep_sort_pytorch\deep_sort\deep\data` a set of data with your own dataset. In this github you will have an example of how the data must be organized.

After running `train.py` you will have a ckpt.t7 to use as mentioned above.
NOTE: Make sure to change inside `\deep_sort_pytorch\deep_sort\deep\model.py` the `number_classes` according to the number of folders used in the training folder. The default value is 756 because that is the lenght of the dataset used in Market1501 dataset. You should also have your images with a size bigger than 120x120 pixels.

## Cite

If you find this project useful in your research, please consider cite:

```latex
@misc{yolov5deepsort2020,
    title={Real-time multi-object tracker using YOLOv5 and deep sort},
    author={Mikel Brostr√∂m},
    howpublished = {\url{https://github.com/mikel-brostrom/Yolov5_DeepSort_Pytorch}},
    year={2020}
}
```
